@model LMSweb.ViewModel.MissionIndexViewModel
@*@section header {
    @Html.Partial("../Shared/Header/HeaderNavbar")
}*@

@section NavPills {
    <ul class="nav nav-pills me-auto ms-3">
        <li class="nav-item">
            <a class="text-white nav-link active" aria-current="page" href="@Url.Action("Index", "Missions", new { CID = Model.CourseID})">任務管理</a>
        </li>
        <li class="nav-item">
            <a class="text-white nav-link" aria-current="page" href="@Url.Action("StudentManagement", "Course", new { CID = Model.CourseID})">學生名單</a>
        </li>
        <li class="nav-item">
            <a class="text-white nav-link" href="@Url.Action("TeacherJourney","LearningBehaviors", new { CID = Model.CourseID})">學習表現</a>
        </li>
        <li class="nav-item">
            <a class="text-white nav-link" href="@Url.Action("TeacherEvalutionJourney","LearningBehaviors",new {CID = Model.CourseID})">學習表現(互評版)</a>
        </li>
    </ul>
}


@*<nav class="navbar navbar-expand-lg navbar-light navBG" style="border-radius: 0 0 5px 5px;">
        <div class="container">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item ">
                        <a class="nav-link text-light active" href="@Url.Action("Home","Teacher")">
                            <i class="bi bi-house-door"></i>
                            回課程首頁
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link text-light" href="@Url.Action("Index", "Missions", new { CID = Model.CourseID})">任務管理</a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link text-light active" aria-current="page" href="@Url.Action("StudentManagement", "Course", new { CID = Model.CourseID})">學生名單</a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link text-light " href="@Url.Action("TeacherJourney","LearningBehaviors", new { CID = Model.CourseID})">學習表現</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-light " href="@Url.Action("TeacherEvalutionJourney","LearningBehaviors",new {CID = Model.CourseID})">學習表現(互評版)</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>*@

<div class="container">
    <div class="card m-3 p-4">
        <h1 class="w-auto fs-2 my-auto">@Model.CourseName</h1>


        @*<div class="position-relative m-4">
                <div class="progress" role="progressbar" aria-label="Progress" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="height: 1px;">
                    <div class="progress-bar" style="width: 50%"></div>
                </div>
                <button type="button" class="position-absolute top-0 start-0 translate-middle btn btn-sm btn-primary rounded-pill" style="width: 2rem; height:2rem;">1</button>
                <button type="button" class="position-absolute top-0 start-50 translate-middle btn btn-sm btn-primary rounded-pill" style="width: 2rem; height:2rem;">2</button>
                <button type="button" class="position-absolute top-0 start-100 translate-middle btn btn-sm btn-secondary rounded-pill" style="width: 2rem; height:2rem;">3</button>
            </div>*@

    </div>

    <div class="card m-3 p-4">
        <div class="row mb-3">
            <div class="col">
                <h3>任務列表</h3>
            </div>
            <div class="col d-flex justify-content-end me-2">
                <a href="@Url.Action("Create", "Missions", new { CID = Model.CourseID})" class="btn btn-primary w-auto mx-2">
                    <i class="bi bi-plus-lg"></i>
                    新增任務
                </a>

                <a href="@Url.Action("SelectMissions", "Missions", new { CID = Model.CourseID })" class="btn btn-primary w-auto">
                    <i class="bi bi-files"></i>
                    複製任務
                </a>
            </div>
        </div>
        @*<div class="row">
            <p class="col-2 fs-5 w-auto my-auto flex-grow-0 h2">任務列表</p>

            <div class="col d-flex justify-content-end">
                <a href="@Url.Action("Create", "Missions", new { CID = Model.CourseID})" class="btn btn-primary w-auto mx-2">
                    <i class="bi bi-plus-lg"></i>
                    新增任務
                </a>

                <a href="@Url.Action("SelectMissions", "Missions", new { CID = Model.CourseID })" class="btn btn-primary w-auto">
                    <i class="bi bi-files"></i>
                    複製任務
                </a>
            </div>
        </div>*@

        @if (Model.Missions.Count == 0)
        {
            <div class="my-5">
                <p class="alert alert-info">目前還沒有新增任務哦~</p>
            </div>
        }
        else
        {
            <table class="table table-striped">
                <thead>
                    <tr class="row mx-1">
                        <th class="col-1">編號</th>
                        <th class="col-3">
                            @Html.DisplayNameFor(model => model.Missions.First().Name)
                        </th>
                        <th class="col">
                            @Html.DisplayNameFor(model => model.Missions.First().StartDate)
                        </th>
                        <th class="col">
                            @Html.DisplayNameFor(model => model.Missions.First().EndDate)
                        </th>
                        <th class="col"></th>
                    </tr>
                </thead>
                <tbody id="number">
                    @foreach (var item in Model.Missions)
                    {
                        <tr class="row bg-white mx-1">
                            <td class="col-1 align-self-center py-3"></td>
                            <td class="col-3 align-self-center py-3">
                                @Html.DisplayFor(modelItem => item.Name)
                            </td>
                            <td class="startTime col align-self-center py-3">
                                @Html.DisplayFor(modelItem => item.StartDate)
                            </td>
                            <td class="endTime col align-self-center py-3">
                                @Html.DisplayFor(modelItem => item.EndDate)
                            </td>
                            <td class="d-grid d-flex justify-content-end col">
                                <a href="@Url.Action("Details","Missions", new { mid=item.MID, cid = Model.CourseID})" class="btn btn-primary">
                                    進入任務
                                </a>
                                <a href="@Url.Action("Edit", "Missions", new {  mid = item.MID, cid = Model.CourseID})" class="btn btn-link">
                                    <i class="bi bi-pencil-fill"></i>
                                </a>
                                <a href="@Url.Action("Delete", "Missions",new { mid=item.MID, cid=Model.CourseID})" class="btn btn-link">
                                    <i class="bi bi-trash-fill"></i>
                                </a>
                            </td>
                            @*<td class="col row">
                                <a href="@Url.Action("Details","Missions", new { mid=item.MID, cid = Model.CourseID})" class="btn btn-primary col-8 w-auto">
                                    進入任務
                                </a>
                                <a href="@Url.Action("Edit", "Missions", new {  mid = item.MID, cid = Model.CourseID})" class="btn btn-link col w-auto">
                                    <i class="bi bi-pencil-fill"></i>
                                </a>
                                <a href="@Url.Action("Delete", "Missions",new { mid=item.MID, cid=Model.CourseID})" class="btn btn-link col w-auto">
                                    <i class="bi bi-trash-fill"></i>
                                </a>
                            </td>*@
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>

@section endJS{
    <script language="javascript" type="text/javascript">
        window.onload = function () {
            var tableLine = document.getElementById("number");
            for (var i = 0; i < tableLine.rows.length; i++) {
                tableLine.rows[i].cells[0].innerHTML = "<span class='ms-2'></span>" + (i + 1);
            }
        }
    </script>
}

@*@section scripts
    {
        <script>
            let startTime, endTime;

            function dateToDisplay(date) {
                console.log("date 1 + " + date)
                // 2022-11-02T14:58
                let outdata = moment(date).format('YYYY-MM-DD');
                console.log(outdata)
                //console.log(outdata)
                return outdata;
            }

            window.onload = function () {
                let tableLine = document.getElementById("number");
                for (var i = 0; i < tableLine.rows.length; i++) {
                    tableLine.rows[i].cells[0].innerHTML = (i + 1);
                }

                startTime = document.querySelectorAll("table tbody tr td:nth-child(3)")
                endTime = document.getElementsByClassName("endTime")
                console.log(startTime)
                startTime.forEach(item => {
                    // console.log(item)
                    item.innerText = dateToDisplay(item.textContent)
                })

                //endTime =  dateToDisplay(endTime)
            }
        </script>
    }*@