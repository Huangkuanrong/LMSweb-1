@model LMSweb.ViewModel.MissionIndexViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section header {
    @Html.Partial("../Shared/Header/HeaderNavbar")
}

<nav class="navbar navbar-expand-lg navbar-light navBG" style="border-radius: 0 0 5px 5px;">
    <div class="container">
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item ">
                    <a class="nav-link text-light active" href="@Url.Action("TeacherHomePage","Teacher")">
                        <i class="bi bi-house-door"></i>
                        回課程首頁
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link text-light" href="@Url.Action("Index", "Missions", new { CID = Model.CourseID})">任務管理</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link text-light active" aria-current="page" href="@Url.Action("StudentManagement", "Course", new { CID = Model.CourseID})">學生名單</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link text-light " href="@Url.Action("TeacherJourney","LearningBehaviors", new { CID = Model.CourseID})">學習表現</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light " href="@Url.Action("TeacherEvalutionJourney","LearningBehaviors",new {CID = Model.CourseID})">學習表現(互評版)</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="card mx-auto my-3 p-5">
        <h4>@Model.CourseName</h4>

        @*<div class="position-relative m-4">
                <div class="progress" role="progressbar" aria-label="Progress" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="height: 1px;">
                    <div class="progress-bar" style="width: 50%"></div>
                </div>
                <button type="button" class="position-absolute top-0 start-0 translate-middle btn btn-sm btn-primary rounded-pill" style="width: 2rem; height:2rem;">1</button>
                <button type="button" class="position-absolute top-0 start-50 translate-middle btn btn-sm btn-primary rounded-pill" style="width: 2rem; height:2rem;">2</button>
                <button type="button" class="position-absolute top-0 start-100 translate-middle btn btn-sm btn-secondary rounded-pill" style="width: 2rem; height:2rem;">3</button>
            </div>*@
        @* 任務引導模組 *@
        <div class="btn-group w-100 mt-3" role="group" aria-label="Basic outlined example">
            <button type="button" disabled class="btn opacity-75 btn-secondary">目標設置</button>
            <button type="button" disabled class="btn opacity-75 btn-secondary">合作討論</button>
            <button type="button" disabled class="btn opacity-100 btn-primary">畫流程圖</button>
            <button type="button" disabled class="btn opacity-100 btn-outline-primary">寫程式碼</button>
            <button type="button" disabled class="btn opacity-100 btn-outline-primary">同儕評價</button>
            <button type="button" disabled class="btn opacity-100 btn-outline-primary">評價回饋</button>
            <button type="button" disabled class="btn opacity-100 btn-outline-primary">團隊反思</button>
        </div>


    </div>

    <div class="card p-5 mt-3">
        <div class="row">
            <p class="col-2 fs-5 w-auto my-auto flex-grow-0">任務列表</p>

            <div class="col d-flex justify-content-end">
                <a href="@Url.Action("Create", "Missions", new { CID = Model.CourseID})" class="btn btn-primary w-auto mx-2">
                    <i class="bi bi-plus-lg"></i>
                    新增任務
                </a>

                <a href="@Url.Action("SelectMissions", "Missions", new { CID = Model.CourseID })" class="btn btn-primary w-auto">
                    <i class="bi bi-files"></i>
                    複製任務
                </a>
            </div>
        </div>

        @if (Model.Missions.Count == 0)
        {
            <div class="my-5">
                <p class="alert alert-info">目前還沒有新增任務哦~</p>
            </div>
        }
        else
        {
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>
                            @Html.DisplayNameFor(model => model.Missions.First().Name)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Missions.First().StartDate)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Missions.First().EndDate)
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="number">
                    @foreach (var item in Model.Missions)
                    {
                        <tr>
                            <td class="col-1"></td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Name)
                            </td>
                            <td class="startTime">
                                @Html.DisplayFor(modelItem => item.StartDate)
                            </td>
                            <td class="endTime">
                                @Html.DisplayFor(modelItem => item.EndDate)
                            </td>
                            <td class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="@Url.Action("Details","Missions", new { mid=item.MID, cid = Model.CourseID})" class="btn btn-primary">
                                    進入任務
                                </a>
                                <a href="@Url.Action("Edit", "Missions", new {  mid = item.MID, cid = Model.CourseID})" class="btn btn-link">
                                    <i class="bi bi-pencil-fill"></i>
                                </a>
                                <a href="@Url.Action("Delete", "Missions",new { mid=item.MID, cid=Model.CourseID})" class="btn btn-link">
                                    <i class="bi bi-trash-fill"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>


</div>


@*@section scripts
{
    <script>
        let startTime, endTime;

        function dateToDisplay(date) {
            console.log("date 1 + " + date)
            // 2022-11-02T14:58
            let outdata = moment(date).format('YYYY-MM-DD');
            console.log(outdata)
            //console.log(outdata)
            return outdata;
        }

        window.onload = function () {
            let tableLine = document.getElementById("number");
            for (var i = 0; i < tableLine.rows.length; i++) {
                tableLine.rows[i].cells[0].innerHTML = (i + 1);
            }

            startTime = document.querySelectorAll("table tbody tr td:nth-child(3)")
            endTime = document.getElementsByClassName("endTime")
            console.log(startTime)
            startTime.forEach(item => {
                // console.log(item)
                item.innerText = dateToDisplay(item.textContent)
            })

            //endTime =  dateToDisplay(endTime)
        }
    </script>
}*@